generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String        @id @default(uuid())
  first_name    String
  last_name     String
  phone         String
  email         String        @unique
  password      String
  company_name  String?
  image_url     String?
  profile_completed Boolean       @default(false)
  verified      Boolean       @default(false)
  type          UserType      @default(USER)
  created_at    DateTime      @default(now())
  updated_at    DateTime      @updatedAt
  packages      Package[]
  dishes        Dish[]
  package_items PackageItem[]
  catererinfo   catererinfo?
}

model catererinfo {
  id                   String   @id @default(uuid())
  business_name        String
  business_type        String
  business_description String?
  service_area         String?
  minimum_guests       Int?
  maximum_guests       Int?
  region               String?
  delivery_only        Boolean  @default(true)
  delivery_plus_setup  Boolean  @default(true)
  full_service         Boolean  @default(true)
  staff                Int?
  servers              Int?
  food_license         String?
  Registration         String?
  caterer_id           String   @unique
  status               Status   @default(PENDING)
  caterer              User     @relation(fields: [caterer_id], references: [id], onDelete: Cascade)
  created_at           DateTime @default(now())
  updated_at           DateTime @updatedAt
}

enum Status {
  PENDING
  APPROVED
  REJECTED
  BLOCKED
}

model CuisineType {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  dishes      Dish[]
}

model Category {
  id                 String                     @id @default(uuid())
  name               String                     @unique
  description        String?
  created_at         DateTime                   @default(now())
  updated_at         DateTime                   @updatedAt
  dishes             Dish[]
  package_selections PackageCategorySelection[]
  subCategories      SubCategory[]
}

model SubCategory {
  id          String   @id @default(uuid())
  name        String
  description String?
  category_id String
  created_at  DateTime @default(now())
  updated_at DateTime @updatedAt
  dishes      Dish[]
  category    Category @relation(fields: [category_id], references: [id], onDelete: Cascade)

  @@unique([name, category_id])
  @@index([category_id])
}

model FreeForm {
  id          String         @id @default(uuid())
  name        String         @unique
  description String?
  created_at  DateTime       @default(now())
  updated_at  DateTime       @updatedAt
  dishes      DishFreeForm[]
}

model DishFreeForm {
  id          String   @id @default(uuid())
  dish_id     String
  freeform_id String
  created_at  DateTime @default(now())
  dish        Dish     @relation(fields: [dish_id], references: [id], onDelete: Cascade)
  freeform    FreeForm @relation(fields: [freeform_id], references: [id], onDelete: Cascade)

  @@unique([dish_id, freeform_id])
  @@index([dish_id])
  @@index([freeform_id])
}

model Dish {
  id              String         @id @default(uuid())
  name            String
  image_url       String?
  cuisine_type_id String
  category_id     String
  sub_category_id String
  caterer_id      String?
  quantity_in_gm  Int?
  pieces          Int            @default(1)
  price           Decimal        @db.Decimal(10, 2)
  currency        String         @default("AED")
  is_active       Boolean        @default(true)
  created_at      DateTime       @default(now())
  updated_at      DateTime       @updatedAt
  category        Category       @relation(fields: [category_id], references: [id])
  cuisine_type    CuisineType    @relation(fields: [cuisine_type_id], references: [id])
  sub_category    SubCategory    @relation(fields: [sub_category_id], references: [id])
  caterer         User?          @relation(fields: [caterer_id], references: [id], onDelete: Cascade)
  free_forms      DishFreeForm[]
  package_items   PackageItem[]

  @@index([cuisine_type_id])
  @@index([category_id])
  @@index([sub_category_id])
  @@index([caterer_id])
  @@index([is_active])
}

model PackageType {
  id          String    @id @default(uuid())
  name        String    @unique
  description String?
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  packages    Package[]
}

model Occassion {
  id          String             @id @default(uuid())
  name        String             @unique
  description String?
  created_at  DateTime           @default(now())
  updated_at  DateTime           @updatedAt
  packages    PackageOccassion[]
}

model PackageOccassion {
  id          String    @id @default(uuid())
  package_id  String
  occasion_id String
  created_at  DateTime  @default(now())
  occassion   Occassion @relation(fields: [occasion_id], references: [id], onDelete: Cascade)
  package     Package   @relation(fields: [package_id], references: [id], onDelete: Cascade)

  @@unique([package_id, occasion_id])
  @@index([package_id])
  @@index([occasion_id])
}

model Package {
  id                  String                     @id @default(uuid())
  name                String
  people_count        Int
  package_type_id     String
  cover_image_url     String?
  total_price         Decimal                    @db.Decimal(10, 2)
  currency            String                     @default("AED")
  rating              Float?
  is_active           Boolean                    @default(true)
  is_available        Boolean                    @default(true)
  caterer_id          String
  created_at          DateTime                   @default(now())
  updated_at          DateTime                   @updatedAt
  caterer             User                       @relation(fields: [caterer_id], references: [id], onDelete: Cascade)
  package_type        PackageType                @relation(fields: [package_type_id], references: [id])
  category_selections PackageCategorySelection[]
  items               PackageItem[]
  occasions           PackageOccassion[]

  @@index([package_type_id])
  @@index([caterer_id])
  @@index([is_active])
  @@index([is_available])
}

model PackageItem {
  id            String   @id @default(uuid())
  package_id    String? // Made nullable so items can exist without a package
  caterer_id    String?
  dish_id       String
  people_count  Int
  is_optional   Boolean  @default(false)
  quantity      Int      @default(1)
  price_at_time Decimal? @db.Decimal(10, 2)
  is_addon      Boolean  @default(false)
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  caterer       User?    @relation(fields: [caterer_id], references: [id], onDelete: Cascade)
  dish          Dish     @relation(fields: [dish_id], references: [id])
  package       Package? @relation(fields: [package_id], references: [id], onDelete: Cascade)

  @@index([package_id])
  @@index([dish_id])
  @@index([is_addon])
}

model PackageCategorySelection {
  id                   String   @id @default(uuid())
  package_id           String
  category_id          String
  num_dishes_to_select Int
  created_at           DateTime @default(now())
  updated_at           DateTime @updatedAt
  category             Category @relation(fields: [category_id], references: [id])
  package              Package  @relation(fields: [package_id], references: [id], onDelete: Cascade)

  @@unique([package_id, category_id])
  @@index([package_id])
  @@index([category_id])
}

enum UserType {
  USER
  ADMIN
  CATERER
}

